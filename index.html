<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>OVHcloud baremetal servers pricelist</title>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4-4.1.1/jq-3.3.1/jszip-2.5.0/dt-1.10.20/b-1.6.1/b-colvis-1.6.1/b-html5-1.6.1/b-print-1.6.1/cr-1.5.2/fh-3.1.6/kt-2.5.1/r-2.2.3/rg-1.1.1/sc-2.0.1/sl-1.3.1/datatables.min.css"/>
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4-4.1.1/jq-3.3.1/jszip-2.5.0/dt-1.10.20/b-1.6.1/b-colvis-1.6.1/b-html5-1.6.1/b-print-1.6.1/cr-1.5.2/fh-3.1.6/kt-2.5.1/r-2.2.3/rg-1.1.1/sc-2.0.1/sl-1.3.1/datatables.min.js"></script>

    <!-- Github button -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <style type="text/css">
        body {
            background-color: #FFF;
            margin: 15px 0 0 0;
            color: #000;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            font-size: 0.8em;
        }
        h1, h2, h3, h4, h5, h6 {
        color: #0050d7;
        }

        .column_search{
            width: 100%;
        }
    </style>
</head>
<body class="container-fluid">

    <div class="row">
        <div class="col-9">
            <h1>OVHcloud baremetal servers pricelist</h1>
        </div>
        <div class="col-3 d-none d-sm-block">
            <span class="float-right">
                <h6><span id="cache-time" class="badge badge-secondary"></span></h6>
            </span>

        </div>
    </div>
    
    <div class="row">
        <div class="col">
            <div class="text">
                <p id="sub-list"></p>
                <p>
                    Pricelist generated via OVHcloud API.
                    You can find the <a target="_blank" href="https://github.com/tdr2d/ovh_pricelist/">source code on Github</a>.
                </p>
            </div>
            <hr/>
            <table id='sd' class='table table-striped table-hover table-bordered table-sm display compact' style='width:100%'>
                <thead class="thead-dark"></thead>
                <tbody></tbody>
            </table>

        </div>
    </div>

<script type="text/javascript">
var SUBSIDIARIES = ['CZ','DE','ES','FI','FR','GB','IE','IT','LT','MA','NL','PL','PT','SN','TN'];
var sub = new URLSearchParams(location.search).get('sub') || 'FR';
document.getElementById('sub-list').innerHTML = SUBSIDIARIES.reduce((acc, s) => acc + `/ <a href="${location.pathname}?sub=${s}">${s == sub ? '<b>'+s+'</b>' : s}</a> `, '');

var cache_bust = new Date().toDateString().replaceAll(' ','');
var url = `https://share.s3.gra.io.cloud.ovh.net/ovh_pricing_plans_${sub.toLowerCase()}.json?cache_bust=${cache_bust}`
fetch(url).then(res => res.json()).then(res => {
    document.getElementById('cache-time').innerText = 'Last updated: ' + new Date(res.date).toString();

    // Set header
    document.querySelector('#sd > thead').innerHTML =`<tr>
        <th>Range</th>
        <th>Name</th>
        <th>API Name</th>
        <th>FQN</th>
        <th>CPU model</th>
        <th>CPU cores</th>
        <th>CPU threads</th>
        <th>CPU clock speed (GHz)</th>
        <th>CPU score</th>
        <th>RAM summary</th>
        <th>RAM size (GB)</th>
        <th>RAM clock speed (GHz)</th>
        <th>RAM type</th>
        <th>Storage summary</th>
        <th>Storage RAID type</th>
        <th>Storage total size</th>
        <th>Disk #1 amount</th>
        <th>Disk #1 capacity</th>
        <th>Disk #1 techno</th>
        <th>Disk #2 amount</th>
        <th>Disk #2 capacity</th>
        <th>Disk #2 techno</th>
        <th>Storage price per GB (${res.currency})</th>
        <th>Public Network</th>
        <th>Private Network</th>
        <th>Frame size</th>
        <th>Frame model</th>
        <th>Setup fee (${res.currency})</th>
        <th>Monthly price (${res.currency})</th>
        <th>Buy</th>
    </tr>`;

    // Set content
    document.querySelector('#sd > tbody').innerHTML = res.plans.reduce((acc, item) => {
        var storage_amount = item['storageSpecs']['specifications']['disks'][0]['number'] * item['storageSpecs']['specifications']['disks'][0]['capacity'];
        
        // If second disk exist, we sum the amount of GB.
        if (item['storageSpecs']['specifications']['disks'].length > 1 && item['storageSpecs']['specifications']['disks'][1]['number'] != '') {
            storage_amount += item['storageSpecs']['specifications']['disks'][1]['number'] * item['storageSpecs']['specifications']['disks'][1]['capacity'];
        }

        return acc + `<tr>
        <td>${item['range'].toUpperCase()}</td>
        <td>${item['invoiceName']}</td>
        <td>${item['planCode']}</td>
        <td>${item['fqn']}</td>
        <td>${item['cpu']['brand']} ${item['cpu']['model']}</td>
        <td>${item['cpu']['cores']}</td>
        <td>${item['cpu']['threads']}</td>
        <td>${item['cpu']['frequency']}</td>
        <td>${item['cpu']['score']}</td>
        <td>${item['memory']['invoiceName']}</td>
        <td>${item['memory']['specifications']['size']}</td>
        <td>${item['memory']['specifications']['frequency']}</td>
        <td>${item['memory']['specifications']['ramType']}</td>
        <td>${item['storageSpecs']['invoiceName']}</td>
        <td>${item['storageSpecs']['specifications']['raid']}</td>
        <td>${storage_amount}</td>
        <td>${item['storageSpecs']['specifications']['disks'][0]['number']}</td>
        <td>${item['storageSpecs']['specifications']['disks'][0]['capacity']}</td>
        <td>${item['storageSpecs']['specifications']['disks'][0]['technology']}</td>
        <td>${item['storageSpecs']['specifications']['disks'].lenght > 1 ? item['storageSpecs']['specifications']['disks'][1]['number'] : ''}</td>
        <td>${item['storageSpecs']['specifications']['disks'].lenght > 1 ? item['storageSpecs']['specifications']['disks'][1]['capacity'] : ''}</td>
        <td>${item['storageSpecs']['specifications']['disks'].lenght > 1 ? item['storageSpecs']['specifications']['disks'][1]['technology'] : ''}</td>
        <td>${parseFloat((item['price'] / storage_amount).toFixed(5))}</td>
        <td>see website</td>
        <td>see website</td>
        <td>${item['frame']['size']}</td>
        <td>${item['frame']['model']}</td>
        <td>${item['setupfee']}</td>
        <td>${item['price'].toFixed(2)}</td>
        <td><a href="https://www.ovhcloud.com/en-ie/bare-metal/prices/" target="_blank">See options</a></td>
    </tr>`;
    }, '');

    $(document).ready(function() {
    
    var mytable = $('#sd').DataTable( {
        orderCellsTop: true,
        ordering: true,
        "order": [[ 1, "asc" ]],
        "bPaginate": true,
        "bLengthChange": true,
        "pageLength": 2000,
        "select": true,
        "fixedHeader": true,
        "sPaginationType": "full_numbers",
        "dom": 'Bfrtip',
        stateSave: false,
        searching: true,
        rowGroup: {
            dataSrc: 1
        },
        "columnDefs": [
            {
                "targets": [2,3,5,6,7,8,10,11,12,14,16,17,18,19,20,21,22,23,24,25,26],
                "visible": false
            }
        ],
        "buttons": [
            'colvis','copy', 'excel', 'pdf', 'csv'
        ]
    } );
    
    } );
})

</script>

</body>
</html>
